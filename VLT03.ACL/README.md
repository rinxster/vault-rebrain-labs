VLT 03: ACL
Описание
Прежде чем приступить к выполнению практического задания, рекомендуем Вам освежить в памяти темы предыдущего вебинара. На уроке мы с Вами разобрали следующие темы:

Key-Value Secret Engine (версии и отличия) — эта практика была в прошлом задании
Token (виды и особенности)
ACL: пишем политики
Если Вы приступили к выполнению практического задания по прошествии нескольких дней с момента вебинара, Вам будет полезно посмотреть запись и повторить пройденный материал.

Подготовка к практике
Для начала работы с Vault выполните:

sudo systemctl restart vault
Задание:
Проведите инициализацию кластера с 3 ключами, любые два из которых распечатывают Vault. Сохраните root token в файл /home/user/root_token.
Включите AuthMethod userpass по пути corp-auth. Установите максимальное время жизни токена - 5 часов, TTL - 1 час.
Напишите общую политику user, которая разрешает каждому пользователю СОЗДАВАТЬ, ОБНОВЛЯТЬ, ИЗМЕНЯТЬ, ЧИТАТЬ, УДАЛЯТЬ и просматривать списком секреты в secret engine kv-development в каталоге, равным его ID. У пользователя не должно быть прав на удаление своего каталога, только секретов в нем.
Напишите политику dev-junior, которая разрешает ТОЛЬКО ЧТЕНИЕ ДАННЫХ секрета db/mysql в kv-development/ и kv-staging/ без доступа к метаданным.
Напишите политику devops-junior, которая разрешает ЧТЕНИЕ И ИЗМЕНЕНИЕ данных db/mysql в kv-development/ и kv-staging/. Полная перезапись должна быть запрещена.
Напишите политику dev-senior, которая разрешает ТОЛЬКО ЧТЕНИЕ данных секрета db/mysql в kv-development/, kv-staging/, kv-production/.
Напишите политику devops-senior, которая разрешает ЧТЕНИЕ, ИЗМЕНЕНИЕ, ПЕРЕЗАПИСЬ и УДАЛЕНИЕ данных секрета db/mysql в kv-development/, kv-staging/, kv-production/.
Создайте пользователей devops-junior, devops-senior, dev-senior, dev-junior и назначьте им соответствующую политику, а также политику user. Для dev-junior и devops-junior - установите максимальное время жизни токена 3 часа и TTL - 40 минут. Для всех пользователей установите пароль в формате password-[username], например для dev-junior: password-dev-junior
Создайте политику с именем partner, которая разрешает только чтение секрета db/mysql в kv-staging .
Создайте token-роль с именем partner, которая разрешает использование ТОЛЬКО политики partner. Сделайте так, чтобы роль выпускала периодические токены с периодом, равным 3 часам.
Перед проверкой оставьте Vault в состоянии unseal.